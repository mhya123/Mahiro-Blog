/* Use postcss-nesting */
@tailwind base;
@tailwind components;
@tailwind utilities;

/* 
 * Global fix for Chromium/WebKit rendering bug:
 * Prevents black wireframe flashing when elements with border-radius 
 * and box-shadow undergo GPU-accelerated transforms (hover:scale, transition).
 */
.card,
.card-base,
[class*="hover:-translate-"],
[class*="hover:scale-"] {
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  will-change: transform;
}

.max-w-blog {
  max-width: 72rem;
  /* 默认90% - 适合小屏幕 */
}

.prose {

  // 只优化链接的上下边距，不影响水平对齐  
  a {
    @apply my-1; // 减少上下边距到 0.25rem  
  }

  // 针对包含图片的链接（徽章样式）  
  a img {
    @apply my-0; // 进一步减少徽章图片的上下边距  
  }

  // 只优化分隔线的上下边距  
  hr {
    @apply my-3; // 上下各 0.75rem 的间距，比默认更紧凑  
  }
}

/* Color scheme configuration to prevent Chrome's auto dark theme */
/* Color scheme configuration to prevent Chrome's auto dark theme */
:root {
  --custom-page-bg: oklch(var(--b2));
  --banner-wave-bg: oklch(var(--b2));

  /* Neumorphism - Adaptive to Theme */
  --neu-base: oklch(var(--b1));
  --neu-text: oklch(var(--bc));
  --neu-accent: oklch(var(--p));

  /* Adaptive Shadows using opacity */
  --neu-border: oklch(var(--bc) / 0.1);
  --neu-btn-text: oklch(var(--bc));
  --neu-btn-bg: oklch(var(--b2));
  /* Slightly different from base */
  --neu-text-muted: oklch(var(--bc) / 0.6);

  /* FORCE Neutral Shadows */
  --shadow-neu-out: 8px 8px 16px 0 rgba(0, 0, 0, 0.05), -8px -8px 16px 0 rgba(255, 255, 255, 0.6) !important;
  --shadow-neu-in: inset 8px 8px 16px 0 rgba(0, 0, 0, 0.05), inset -8px -8px 16px 0 rgba(255, 255, 255, 0.6) !important;
}

[data-theme-type="light"] {
  color-scheme: light;
  --shadow-neu-out: 8px 8px 16px 0 rgba(0, 0, 0, 0.05), -8px -8px 16px 0 rgba(255, 255, 255, 0.6) !important;
  --shadow-neu-in: inset 8px 8px 16px 0 rgba(0, 0, 0, 0.05), inset -8px -8px 16px 0 rgba(255, 255, 255, 0.6) !important;
}

[data-theme-type="dark"] {
  color-scheme: dark;
  --neu-base: oklch(var(--b1));
  --neu-text: oklch(var(--bc));
  --neu-border: oklch(var(--bc) / 0.1);
  --neu-btn-text: oklch(var(--bc));
  --neu-btn-bg: oklch(var(--b2));
  --neu-text-muted: oklch(var(--bc) / 0.5);
  --neu-accent: oklch(var(--p));

  /* Dark Shadows */
  --shadow-neu-out: 8px 8px 16px 0 rgba(0, 0, 0, 0.4), -8px -8px 16px 0 rgba(255, 255, 255, 0.02) !important;
  --shadow-neu-in: inset 8px 8px 16px 0 rgba(0, 0, 0, 0.4), inset -8px -8px 16px 0 rgba(255, 255, 255, 0.02) !important;
}

/* Banner Modes */
[data-banner-mode="fullscreen"] {
  .banner {
    height: 100vh !important;
  }
}

[data-banner-mode="hidden"] {
  .banner {
    display: none !important;
  }

  .page-content-animate {
    margin-top: 6rem !important;
    min-height: calc(100vh - 6rem - 100px);
    /* Ensure footer is pushed down */
  }

  /* Remove navbar shadow in hidden mode */
  #navbar-bg,
  #navbar-mobile>div {
    box-shadow: none !important;
  }
}

[data-banner-mode="background"] {
  background-color: transparent !important;

  body {
    background-color: transparent !important;
  }

  /* 移除之前的伪元素实现 */
  body::before,
  body::after {
    display: none !important;
  }

  /* 复用 Banner 组件作为背景，实现无缝切换效果 */
  .banner {
    display: block !important;
    position: fixed !important;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh !important;
    z-index: -2;
    /* 位于最底层 */
    opacity: 1 !important;
    pointer-events: none;
    /* 确保不阻挡点击 */
  }

  /* 隐藏 Banner 中的文字内容和波浪 */
  .banner .banner-inner>.relative.z-20,
  /* 标题容器 */
  .banner .waves {
    display: none !important;
  }

  /* 适配暗色模式遮罩 - 加深 Banner 内部的遮罩层 */
  &[data-theme-type="dark"] .banner .banner-inner>.absolute.z-10 {
    background-color: rgba(0, 0, 0, 0.5);
  }

  .page-content-animate {
    margin-top: 6rem !important;
    min-height: calc(100vh - 6rem - 100px);
  }

  /* Make components semi-transparent in background mode */
  /* General rule for card-like elements */
  .bg-base-100,
  .card-base,
  .card,
  .music-player-widget>.bg-neu-base {
    background-color: oklch(var(--b1) / 0.85) !important;
    border: 1px solid oklch(var(--bc) / 0.1);
  }

  /*
   * 仅对不参与 transform 动画的静态元素使用 backdrop-filter，
   * 避免 Chromium 在 backdrop-filter + border-radius + GPU transform
   * 组合下产生的黑色线框闪烁 Bug。
   */
  .card {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }

  /* Just make inner neumorphic elements transparent, NO border/blur/shadow to avoid visual noise */
  .bg-neu-base {
    background-color: oklch(var(--b1) / 0.7) !important;
  }

  /* 
   * 在透明背景模式下，强烈的拟态阴影会让界面看起来"脏"或者不协调。
   * 因此我们移除拟态阴影，改为更适合玻璃拟态的简单阴影。
   */
  --shadow-neu-out: 0 10px 15px -3px rgba(0, 0, 0, 0.1) !important;
  --shadow-neu-in: inset 0 2px 4px 0 rgba(0, 0, 0, 0.05) !important;

  /* Increase visibility of muted text in background mode - maximize contrast */
  --neu-text-muted: oklch(var(--bc)) !important;

  /* Fix flickering line issue in background mode */
  .music-player-widget>.bg-neu-base {
    transform: translate3d(0, 0, 0);
    /* Force GPU acceleration to prevent repaint glitches */
    backface-visibility: hidden;
    will-change: transform;
    /* Hint to browser to keep this layer stable */
  }

  .bg-base-200 {
    background-color: oklch(var(--b2) / 0.85) !important;
  }

  .bg-base-300 {
    background-color: oklch(var(--b3) / 0.85) !important;
  }

  /* Navbar specific */
  #navbar-bg {
    background-color: oklch(var(--b1) / 0.6) !important;
    backdrop-filter: blur(12px);
  }

  /* Navigation page container specific */
  .nav-container {
    background-color: transparent !important;
    backdrop-filter: none !important;
  }
}

/* Global styles with nesting support */
html {
  @apply scroll-smooth font-sans;
  font-family: theme('fontFamily.sans') !important;
  /* 强制使用自定义字体，防止主题覆盖 */
  font-size: 16px;
  /* 桌面端默认字号 */
  line-height: 1.75;
  /* 增加行高，提升阅读体验 */
  -webkit-font-smoothing: antialiased;
  /* 字体平滑，让圆体更清晰 */
  -moz-osx-font-smoothing: grayscale;

  @media (max-width: 640px) {
    font-size: 15px;
    /* 移动端微调字号 */
    line-height: 1.65;
    /* 移动端行高稍紧凑 */
  }
}

body {
  font-weight: 400;
  /* 圆体在常规字重下也很可爱，可视情况调整为 500 */
}

h1,
h2,
h3,
h4,
h5,
h6 {
  @apply font-bold;
  line-height: 1.3;
  letter-spacing: 0.02em;
  /* 标题稍微增加字间距 */
}

kbd {
  @apply kbd;
}

code {
  @apply font-mono;
  font-size: 0.9em;
}

.scrollbar-none {
  -ms-overflow-style: none;
  /* IE and Edge */
  scrollbar-width: none;

  /* Firefox */
  &::-webkit-scrollbar {
    display: none;
    /* Chrome, Safari and Opera */
  }
}

.mahiro-heading {
  @apply text-lg md:text-2xl leading-tight pt-0 font-bold text-base-content bg-clip-text bg-gradient-to-r from-primary to-secondary duration-300 hover:text-transparent;
}

.btn-category {
  @apply bg-primary/5 hover:bg-primary text-primary hover:text-primary-content border-none hover:scale-110;
}

.btn-tag {
  @apply bg-secondary/5 hover:bg-secondary text-secondary hover:text-secondary-content border-none hover:scale-110;
}

.btn-copy {
  @apply px-1 text-base-content/80;
}

.mahiro-code {
  @apply relative my-4 rounded-xl border border-base-300/20 bg-transparent overflow-hidden;

  &-toolbar {
    @apply sticky top-0 z-10 flex justify-between items-center px-4 py-2 bg-base-200 border-b border-base-content/20;

    &-language {
      @apply text-sm font-semibold text-base-content/80;
    }
  }

  &-content {
    @apply overflow-x-auto py-2 px-4 bg-transparent text-sm text-base-content/80 leading-snug;

    pre {
      @apply bg-transparent;
      counter-reset: line;
    }

    code {
      font-size: inherit;
    }

    .line {
      counter-increment: line;

      &::before {
        content: counter(line);
        @apply text-current mr-4 inline-block w-4 text-right;
      }
    }
  }
}

// Shared components and styles for blog pages
// ===================================================

// Footnotes styles
// ---------------------------------------------------
.footnotes {
  @apply mt-12 p-6 rounded-2xl bg-base-200/50 backdrop-blur-sm border border-base-content/20 shadow-sm;

  // Footnote list item
  li {
    @apply text-sm text-base-content/80 relative;
  }
}

// Animation keyframes
@keyframes fade-in-up {
  0% {
    opacity: 0;
    transform: translateY(20px);
  }

  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

/* .page-content-animate — 已由 GSAP 接管入场动画，见 BaseLayout.astro */

@keyframes fadeIn {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

// Common container for blog pages
.blog-container {
  @apply p-4 rounded-3xl bg-base-200/30 backdrop-blur-md border border-base-300/20;
}

// Common stats box
.stats-box {
  @apply stats shadow mb-8 w-full bg-base-200/50 backdrop-blur-sm border border-base-content/20;

  .stat-figure {
    @apply text-primary;

    svg {
      @apply w-8 h-8;
    }
  }

  .stat-value {
    @apply text-primary;
  }
}

// Empty state component
.empty {
  &-state {
    @apply flex flex-col items-center justify-center min-h-[200px] p-8 text-center text-base-content/60 bg-base-100/50 rounded-2xl border border-dashed border-base-300/20;
  }

  &-icon {
    @apply w-12 h-12 opacity-60 mb-4;
  }

  &-text {
    @apply text-lg;
  }
}

// Categories Page Components
// ===================================================

// Category component styles
.categories {
  &-container {
    @extend .blog-container;
  }

  &-grid {
    @apply grid gap-6;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  }
}

// Category card component
.category {
  &-card {
    @apply opacity-0 translate-y-5;
    animation: fadeIn 0.8s ease-out forwards;

    // Generate animation delays
    @for $i from 0 through 100 {
      &[data-index="#{$i}"] {
        animation-delay: #{0.1 + ($i * 0.05)}s;
      }
    }
  }

  &-inner {
    @apply rounded-2xl overflow-hidden bg-base-100 shadow-md border border-base-300/20 transition-transform duration-300 ease-in-out;

    &:hover {
      @apply -translate-y-1 shadow-lg;
    }

    &.expanded {
      @apply shadow-xl;
    }
  }

  &-header {
    @apply p-4 cursor-pointer flex justify-between items-center;
  }

  &-title {
    @apply flex items-center gap-3;

    h2 {
      @apply text-lg font-semibold m-0;
    }
  }

  &-icon {
    @apply flex items-center justify-center w-10 h-10 rounded-full flex-shrink-0;

    svg {
      @apply w-5 h-5;
    }
  }

  &-count {
    @apply inline-flex items-center justify-center min-w-6 h-6 px-2 rounded-full text-xs font-bold;
  }

  &-divider {
    @apply h-px bg-base-300/50 mx-4;
  }

  &-content {
    @apply max-h-0 overflow-y-auto;
    transition: max-height 0.8s;
  }
}

// Toggle button
.toggle {
  &-btn {
    @apply bg-transparent border-none cursor-pointer p-1 flex items-center justify-center text-base-content/70;
  }

  &-icon {
    @apply w-6 h-6 transition-transform duration-500;
  }
}

// Post list
.post {
  &-list {
    @apply list-none p-4 m-0 bg-base-100/70;
  }

  &-item {
    @apply mb-2;

    &:last-child {
      @apply mb-0;
    }
  }

  &-link {
    @apply flex justify-between items-center p-3 rounded-lg bg-base-200/50 transition-transform;

    &:hover {
      @apply bg-base-200 translate-x-1;

      .post-title {
        @apply text-primary;
      }
    }
  }

  &-title {
    @apply font-medium overflow-hidden text-ellipsis whitespace-nowrap text-base-content/90;
  }

  &-date {
    @apply text-xs text-base-content/60 whitespace-nowrap py-1 px-2 rounded-full bg-base-300/30;
  }
}

// Mixin for creating category color variants
@mixin category-color-variant($color-var) {
  .category-#{$color-var} {
    .category-header {
      background: linear-gradient(120deg, oklch(var(--#{$color-var}) / 0.1), oklch(var(--#{$color-var}) / 0.05));
    }

    .category-icon {
      background-color: oklch(var(--#{$color-var}) / 0.15);
      color: oklch(var(--#{$color-var}));
    }

    .category-count {
      background-color: oklch(var(--#{$color-var}) / 0.15);
      color: oklch(var(--#{$color-var}));
    }

    &.expanded {
      border-color: oklch(var(--#{$color-var}) / 0.3);
    }
  }
}

// Apply color variants
@include category-color-variant("p");
@include category-color-variant("s");
@include category-color-variant("a");
@include category-color-variant("in");
@include category-color-variant("su");
@include category-color-variant("wa");
@include category-color-variant("er");

// Rename for clarity in the component
.category-primary {
  @extend .category-p;
}

.category-secondary {
  @extend .category-s;
}

.category-accent {
  @extend .category-a;
}

.category-info {
  @extend .category-in;
}

.category-success {
  @extend .category-su;
}

.category-warning {
  @extend .category-wa;
}

.category-error {
  @extend .category-er;
}

// Tags Page Components
// ===================================================

.tags {
  &-container {
    @extend .blog-container;
  }

  &-cloud {
    @apply flex flex-wrap justify-center gap-3 min-h-[200px];
  }

  &-item {
    @apply relative opacity-0 translate-y-2 inline-flex items-center gap-2 rounded-full;
    animation: fadeIn 0.8s ease-out forwards;

    // Height fix - improved tag height
    @apply h-auto py-0;

    // Apply staggered animation with loop
    @for $i from 0 through 100 {
      &[data-index="#{$i}"] {
        animation-delay: #{0.05 + ($i * 0.02)}s;
      }
    }
  }

  &-content {
    @apply flex items-center gap-2 px-4 py-2 rounded-full bg-base-100 shadow-sm border border-transparent;
  }

  &-icon {
    @apply w-4 h-4 flex-shrink-0;
  }

  &-count {
    @apply inline-flex items-center justify-center min-w-6 h-6 px-2 text-xs font-bold rounded-full bg-base-300/30 text-base-content/80 duration-300;
  }
}

// Tag color variants
.tag {
  &-high {
    .tags-content {
      @apply border-primary/20 bg-base-100 text-primary;
    }

    .tags-icon {
      @apply text-primary;
    }
  }

  &-medium-high {
    .tags-content {
      @apply border-secondary/20 bg-base-100 text-secondary;
    }

    .tags-icon {
      @apply text-secondary;
    }
  }

  &-medium {
    .tags-content {
      @apply border-accent/20 bg-base-100 text-accent;
    }

    .tags-icon {
      @apply text-accent;
    }
  }

  &-medium-low {
    .tags-content {
      @apply border-base-content/20 bg-base-100;
    }

    .tags-icon {
      @apply text-base-content/80;
    }
  }

  &-low {
    .tags-content {
      @apply border-base-300/20 bg-base-100;
    }

    .tags-icon {
      @apply text-base-content/60;
    }
  }
}

// Archives Page Components
// ===================================================

.archives {
  &-container {
    @extend .blog-container;
  }

  &-timeline {
    @apply relative pl-8 ml-4;

    &::before {
      content: "";
      @apply absolute top-0 bottom-0 left-1 w-1 rounded bg-gradient-to-b from-primary to-secondary;
    }
  }
}

.timeline {
  &-year {
    @apply relative mb-12;

    &:last-child {
      @apply mb-0;
    }
  }

  &-month {
    @apply mb-10 relative;

    &:last-child {
      @apply mb-0;
    }
  }
}

.year {
  &-header {
    @apply relative mb-6;
  }

  &-badge {
    @apply relative -left-12 bg-primary text-primary-content font-bold text-lg py-2 px-4 rounded-full inline-block shadow-md z-10;
  }

  &-content {
    @apply relative;
  }
}

.month {
  &-title {
    @apply flex items-center gap-2 text-xl font-semibold mb-5 text-secondary pb-2 border-b border-base-content/20;
  }

  &-icon {
    @apply w-5 h-5;
  }

  &-count {
    @apply inline-flex items-center justify-center bg-secondary text-secondary-content text-xs font-bold min-w-6 h-6 rounded-full px-2 ml-2;
  }
}

.archive {
  &-posts {
    @apply list-none p-0 m-0 relative;
  }

  &-item {
    @apply relative mb-4 pl-6 flex flex-col;

    &:last-child {
      @apply mb-0;
    }
  }

  &-marker {
    @apply absolute -left-2 top-4 w-8 h-8 flex items-center justify-center bg-base-100 border-2 border-primary rounded-full z-10;
  }

  &-icon {
    @apply w-4 h-4 text-primary;
  }

  &-card {
    @apply block p-5 bg-base-100 border border-base-content/20 rounded-xl shadow-sm transition-transform duration-300;

    &:hover {
      @apply -translate-y-1 shadow-md border-primary/50 bg-base-200;

      .archive-title {
        @apply text-primary;
      }
    }
  }

  &-date {
    @apply text-sm text-base-content/60 mb-1;
  }

  &-title {
    @apply font-semibold mt-1 text-base-content line-clamp-2;
  }

  &-description {
    @apply text-sm text-base-content/70 mt-2 line-clamp-2;
  }
}

// Responsive styles for all pages
@media (max-width: 768px) {
  .blog-container {
    @apply p-3;
  }

  // Categories responsive
  .categories-grid {
    @apply grid-cols-1 gap-4;
  }

  .category-header {
    @apply py-3 px-4;
  }

  .category-icon {
    @apply w-8 h-8;

    svg {
      @apply w-4 h-4;
    }
  }

  // Tags responsive
  .tags-cloud {
    @apply gap-2;
  }

  .tags-content {
    @apply px-3 py-1.5;
  }

  // Archives responsive
  .archives-timeline {
    @apply pl-6 ml-0;
  }

  .year-badge {
    @apply -left-10 text-base py-1.5 px-3;
  }

  .archive-card {
    @apply p-4;
  }

  .archive-marker {
    @apply w-7 h-7 -left-2;
  }

  .archive-icon {
    @apply w-3.5 h-3.5;
  }
}

@media (max-width: 480px) {
  .blog-container {
    @apply p-2;
  }

  // Categories responsive
  .category-title h2 {
    @apply text-base;
  }

  .post-link {
    @apply py-2 px-3 flex-col items-start gap-1;
  }

  .post-date {
    @apply self-start;
  }

  // Tags responsive
  .tags-item {
    // Fixed height for small screens
    font-size: 0.9rem !important;
  }

  .tags-icon {
    @apply w-3.5 h-3.5;
  }

  .tags-count {
    @apply min-w-5 h-5 text-[0.65rem];
  }

  // Archives responsive
  .archives-timeline {
    @apply pl-5;
  }

  .year-badge {
    @apply -left-9 text-sm py-1 px-2.5;
  }

  .month-title {
    @apply text-lg;
  }
}

/* Pagefind UI customization with oklch colors */
#pagefind-search {
  --pagefind-ui-scale: 1;
  --pagefind-ui-primary: oklch(var(--a));
  --pagefind-ui-text: oklch(var(--bc));
  --pagefind-ui-background: oklch(var(--b1));
  --pagefind-ui-border: oklch(var(--bc) / 0.2);
  --pagefind-ui-tag: oklch(var(--b2));
  --pagefind-ui-border-width: 1px;
  --pagefind-ui-border-radius: 0.5rem;
  --pagefind-ui-image-border-radius: 0.5rem;
  --pagefind-ui-image-box-ratio: 3/2;
  --pagefind-ui-font: var(--font-sans, system-ui, sans-serif);

  .pagefind-ui__search-input {
    @apply input input-bordered w-full;
    border: 1px solid oklch(var(--bc) / 0.2);
  }

  .pagefind-ui__search-clear {
    @apply hidden;
  }

  .pagefind-ui__result {
    @apply p-4 border rounded-lg mb-4;
    border: 1px solid var(--pagefind-ui-border);
  }

  .pagefind-ui__result-title {
    @apply text-lg font-bold mb-2;
  }

  .pagefind-ui__result-link {
    @apply text-primary hover:underline;
  }

  .pagefind-ui__result-excerpt {
    @apply text-sm text-base-content opacity-75;
  }

  .pagefind-ui__result-excerpt mark {
    @apply bg-accent text-accent-content px-1 rounded;
  }

  .pagefind-ui__button {
    @apply btn btn-primary;
  }

  .pagefind-ui__message {
    @apply text-sm text-base-content opacity-75 my-4;
  }

  .pagefind-ui__message:empty::before {
    content: "No results found. Try a different search term.";
    @apply block text-center py-8 text-base-content opacity-50;
  }
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translate3d(0, 20px, 0);
  }

  to {
    opacity: 1;
    transform: translate3d(0, 0, 0);
  }
}

.page-content-animate {
  /* GSAP will handle the entrance and exit animations */
}

/* ===================================================
 * Onload Staggered Entry Animation System
 * 
 * 使用方式：给需要入场动画的元素添加 .onload-animation
 * GSAP 在 astro:page-load 时自动处理
 * 手动延迟：data-stagger-index="0/1/2/3..." 
 * =================================================== */
.onload-animation {
  opacity: 0;
  transform: translateY(30px);
}

/* 无 JS 回退：如果 GSAP 没有加载，用 CSS 动画作为后备 */
@media (prefers-reduced-motion: no-preference) {
  .no-js .onload-animation {
    animation: fade-in-up 0.6s ease-out forwards;
  }

  @for $i from 0 through 20 {
    .no-js .onload-animation[data-stagger-index="#{$i}"] {
      animation-delay: #{$i * 0.08}s;
    }
  }
}

/* 用户偏好：减少动画时跳过所有动画 */
@media (prefers-reduced-motion: reduce) {
  .onload-animation,
  .page-content-animate {
    opacity: 1 !important;
    transform: none !important;
    animation: none !important;
  }
}

/* ===================================================
 *  Rainbow Mode — 彩虹色文字渐变动画
 * 
 * 给元素加 .rainbow-text 即可
 * =================================================== */
@keyframes rainbow-shift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.rainbow-text {
  background: linear-gradient(
    90deg,
    #ff6b6b, #feca57, #48dbfb, #ff9ff3, #54a0ff, #5f27cd, #ff6b6b
  );
  background-size: 300% 100%;
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: rainbow-shift 4s ease-in-out infinite;
}

/* Rainbow border variant */
.rainbow-border {
  position: relative;
  z-index: 0;

  &::before {
    content: "";
    position: absolute;
    inset: -2px;
    border-radius: inherit;
    background: linear-gradient(
      90deg,
      #ff6b6b, #feca57, #48dbfb, #ff9ff3, #54a0ff, #5f27cd, #ff6b6b
    );
    background-size: 300% 100%;
    animation: rainbow-shift 4s ease-in-out infinite;
    z-index: -1;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    -webkit-mask-composite: xor;
    padding: 2px;
  }
}

/* ===================================================
 * Pulsate Loading — 脉冲加载动画
 * 
 * 用于骨架屏或加载占位
 * =================================================== */
@keyframes pulsate {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.4;
  }
}

.animate-pulsate {
  animation: pulsate 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

/* Skeleton loader variant */
@keyframes skeleton-shimmer {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}

.skeleton-loading {
  background: linear-gradient(
    90deg,
    oklch(var(--b2)) 25%,
    oklch(var(--b3)) 50%,
    oklch(var(--b2)) 75%
  );
  background-size: 200% 100%;
  animation: skeleton-shimmer 1.5s ease-in-out infinite;
  border-radius: 0.5rem;
}

/* ===================================================
 * ✨ Shine Text — 文字光泽扫过动画
 * 
 * 用于标题或重要文字的高光效果
 * =================================================== */
@keyframes shine-sweep {
  0% { background-position: -200% center; }
  100% { background-position: 200% center; }
}

.shine-text {
  background: linear-gradient(
    90deg,
    oklch(var(--bc)) 0%,
    oklch(var(--bc)) 40%,
    oklch(var(--p)) 50%,
    oklch(var(--bc)) 60%,
    oklch(var(--bc)) 100%
  );
  background-size: 200% auto;
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: shine-sweep 3s linear infinite;
}

/* ===================================================
 *  Bounce — 弹跳动画
 * 
 * 用于代码块复制成功、通知出现等
 * =================================================== */
@keyframes bounce-in {
  0% {
    opacity: 0;
    transform: scale(0.3);
  }
  50% {
    opacity: 1;
    transform: scale(1.05);
  }
  70% {
    transform: scale(0.9);
  }
  100% {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes bounce-gentle {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-6px);
  }
}

.animate-bounce-in {
  animation: bounce-in 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
}

.animate-bounce-gentle {
  animation: bounce-gentle 2s ease-in-out infinite;
}

/* ===================================================
 *  Gradient Mask — TOC 滚动渐变遮罩
 * 
 * 当 TOC 内容超出可视区域时，在顶部/底部添加渐变遮罩
 * 暗示用户可以继续滚动
 * =================================================== */
.toc-nav {
  mask-image: linear-gradient(
    to bottom,
    transparent 0%,
    black 5%,
    black 90%,
    transparent 100%
  );
  -webkit-mask-image: linear-gradient(
    to bottom,
    transparent 0%,
    black 5%,
    black 90%,
    transparent 100%
  );
}

/* 当内容不溢出时不需要遮罩 */
.toc-nav:not(.is-overflowing) {
  mask-image: none;
  -webkit-mask-image: none;
}

/* ===================================================
 *  Hover Micro-Interactions
 * 
 * 按压反馈、悬浮高亮、图标旋转等交互动效
 * =================================================== */

/* 按压缩小反馈 */
.press-effect {
  transition: transform 0.15s ease;

  &:active {
    transform: scale(0.95);
  }
}

/* 悬浮发光效果 */
.hover-glow {
  transition: box-shadow 0.3s ease;

  &:hover {
    box-shadow: 0 0 20px oklch(var(--p) / 0.3);
  }
}

/* 悬浮图标旋转 */
.hover-icon-spin {
  &:hover svg,
  &:hover .icon {
    animation: spin-slow 1s linear;
  }
}

/* 涟漪效果 (CSS-only) */
.ripple-effect {
  position: relative;
  overflow: hidden;

  &::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: oklch(var(--p) / 0.2);
    transform: translate(-50%, -50%);
    transition: width 0.6s ease, height 0.6s ease, opacity 0.6s ease;
    opacity: 0;
  }

  &:active::after {
    width: 300px;
    height: 300px;
    opacity: 1;
    transition: 0s;
  }
}

/* ===================================================
 *  Scale & Float Utility Animations
 * =================================================== */
@keyframes float {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-10px);
  }
}

.animate-float {
  animation: float 3s ease-in-out infinite;
}

/* 呼吸灯效果 */
@keyframes breathe {
  0%, 100% {
    box-shadow: 0 0 5px oklch(var(--p) / 0.2);
  }
  50% {
    box-shadow: 0 0 20px oklch(var(--p) / 0.5);
  }
}

.animate-breathe {
  animation: breathe 3s ease-in-out infinite;
}

/* ===================================================
 *  Number Counter Animation (配合 animate-value.ts)
 *
 * 给数字元素加 .counter-value 获得弹入效果
 * =================================================== */
.counter-value {
  display: inline-block;
  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.counter-value.is-counting {
  transform: scale(1.1);
}

/* 强制统一所有主题的圆角设置，防止某些主题修改圆角 */
:root,
[data-theme] {
  --rounded-box: 1rem !important;
  --rounded-btn: 0.5rem !important;
  --rounded-badge: 1.9rem !important;
}

@keyframes spin-slow {
  from {
    transform: rotate(0deg);
  }

  to {
    transform: rotate(360deg);
  }
}

.animate-spin-slow {
  animation: spin-slow 8s linear infinite;
}